<!DOCTYPE html>
<html>
<head>
<title>Honest Perception</title>

<style>
* { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

body {
    margin:0;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    overflow:hidden;
    background: linear-gradient(135deg,#667eea,#764ba2,#ff6a88,#ff99ac);
    background-size:300% 300%;
    animation: gradientMove 12s ease infinite;
}

@keyframes gradientMove {
    0% {background-position:0% 50%}
    50% {background-position:100% 50%}
    100% {background-position:0% 50%}
}

canvas {
    position:fixed;
    top:0;
    left:0;
    z-index:-1;
}

.card {
    width:760px;
    padding:60px;
    border-radius:30px;
    backdrop-filter:blur(25px);
    background:rgba(255,255,255,0.15);
    box-shadow:0 40px 80px rgba(0,0,0,0.35);
    text-align:center;
    color:white;
    transition: all 0.4s ease;
}

h1 {
    font-size:32px;
    margin-bottom:35px;
}

.question {
    font-size:24px;
    margin-bottom:25px;
}

.progress-bar-container {
    width:100%;
    height:6px;
    background:rgba(255,255,255,0.2);
    border-radius:10px;
    margin-bottom:20px;
    overflow:hidden;
}

.progress-bar {
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#00f5a0,#00d9f5,#ff6a88);
    transition:width 0.4s ease;
}

.progress-ring {
    margin:0 auto 15px auto;
    width:70px;
    height:70px;
}

.options {
    display:flex;
    flex-wrap:wrap;
    gap:15px;
    justify-content:center;
    margin-bottom:25px;
}

.option-card {
    padding:12px 25px;
    border-radius:30px;
    cursor:pointer;
    font-size:14px;
    background:linear-gradient(135deg,#ff9a9e,#fad0c4);
    color:#333;
    font-weight:600;
    transition: all 0.3s ease;
}

.option-card:hover {
    transform:translateY(-6px) scale(1.05);
    box-shadow:0 15px 25px rgba(0,0,0,0.3);
}

.option-card.selected {
    background:linear-gradient(135deg,#00f5a0,#00d9f5);
    color:white;
    box-shadow:0 0 20px rgba(0,255,200,0.7);
    transform:scale(1.08);
}

input, textarea {
    width:100%;
    padding:16px;
    border-radius:15px;
    border:none;
    margin-bottom:20px;
    font-size:15px;
    outline:none;
}

input:focus, textarea:focus {
    box-shadow:0 0 20px rgba(255,255,255,0.6);
    transform:scale(1.02);
}

input[type=range] {
    width:100%;
    appearance:none;
    height:6px;
    border-radius:5px;
    background:linear-gradient(90deg,#00f5a0,#00d9f5,#ff6a88);
}

input[type=range]::-webkit-slider-thumb {
    appearance:none;
    width:22px;
    height:22px;
    border-radius:50%;
    background:white;
    box-shadow:0 0 20px #00f5a0;
    cursor:pointer;
}

button {
    padding:15px 40px;
    border-radius:30px;
    border:none;
    font-weight:bold;
    cursor:pointer;
    background:white;
    color:#333;
    transition:0.3s;
}

button:hover {
    transform:translateY(-5px);
    box-shadow:0 15px 30px rgba(0,0,0,0.3);
}
</style>
</head>

<body>

<canvas id="bg"></canvas>

<div class="card">
    <h1>ðŸ’¬ What Do You Really Think About Me?</h1>
    <div id="content">
        <input type="text" id="nameInput" placeholder="Enter your name">
        <button onclick="startQuiz()">Begin</button>
    </div>
</div>

<script>
// PARTICLES
const canvas=document.getElementById("bg");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

let particles=[];
for(let i=0;i<60;i++){
particles.push({
x:Math.random()*canvas.width,
y:Math.random()*canvas.height,
r:Math.random()*3,
dx:(Math.random()-0.5)*0.5,
dy:(Math.random()-0.5)*0.5
});
}

function animate(){
ctx.clearRect(0,0,canvas.width,canvas.height);
ctx.fillStyle="rgba(255,255,255,0.4)";
particles.forEach(p=>{
ctx.beginPath();
ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
ctx.fill();
p.x+=p.dx;
p.y+=p.dy;
});
requestAnimationFrame(animate);
}
animate();

// CONFETTI
function launchConfetti(){
for(let i=0;i<120;i++){
const c=document.createElement("div");
c.style.position="fixed";
c.style.width="8px";
c.style.height="8px";
c.style.background=`hsl(${Math.random()*360},100%,50%)`;
c.style.top="50%";
c.style.left="50%";
c.style.borderRadius="50%";
c.style.zIndex="9999";
document.body.appendChild(c);
const angle=Math.random()*2*Math.PI;
const dist=Math.random()*600;
c.animate([
{transform:"translate(0,0)",opacity:1},
{transform:`translate(${Math.cos(angle)*dist}px,${Math.sin(angle)*dist}px)`,opacity:0}
],{duration:1500,easing:"ease-out"});
setTimeout(()=>c.remove(),1500);
}
}

// QUIZ
let sessionId=null;
let currentQuestion=0;
let selectedOptions=[];

const questions=[
{ id:"personality", text:"How would you describe my personality?", type:"multi",
options:["Confident","Calm","Ambitious","Caring","Funny","Reserved","Overthinking","Dominating","Insecure"] },
{ id:"standout", text:"Where do I naturally stand out?", type:"multi",
options:["Communication","Leadership","Emotional Support","Technical Skills","Decision Making","Discipline","Creativity","Networking"] },
{ id:"confidence", text:"How confident do I appear? (1â€“10)", type:"slider" },
{ id:"advice", text:"One brutally honest advice for me:", type:"text" }
];

async function startQuiz(){
const name=document.getElementById("nameInput").value.trim();
if(!name) return alert("Enter your name");

const res=await fetch("/start-session",{method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({name})});

const data=await res.json();
sessionId=data.sessionId;
showQuestion();
}

function showQuestion(){
const q=questions[currentQuestion];
selectedOptions=[];
let percent=(currentQuestion/questions.length)*100;

let circle=`<svg class="progress-ring">
<circle stroke="rgba(255,255,255,0.3)" stroke-width="6" fill="transparent" r="28" cx="35" cy="35"/>
<circle stroke="white" stroke-width="6" fill="transparent"
r="28" cx="35" cy="35"
stroke-dasharray="${percent*1.75} 175"
transform="rotate(-90 35 35)"/>
</svg>`;

let html=`
${circle}
<div class="progress-bar-container">
<div class="progress-bar" style="width:${percent}%"></div>
</div>
<div class="question">${q.text}</div>`;

if(q.type==="multi"){
html+=`<div class="options">`;
q.options.forEach(opt=>{
html+=`<div class="option-card" onclick="toggleOption(this,'${opt}')">${opt}</div>`;
});
html+=`</div>`;
}

if(q.type==="slider"){
html+=`<input type="range" min="1" max="10" value="5" id="slider"
oninput="document.getElementById('sliderValue').innerText=this.value">
<div id="sliderValue" style="margin-top:10px;font-size:22px;">5</div>`;
}

if(q.type==="text"){
html+=`<textarea id="answerInput" placeholder="Type your answer..."></textarea>`;
}

html+=`<button onclick="nextQuestion()">Next</button>`;

document.getElementById("content").innerHTML=html;
}

function toggleOption(el,val){
el.classList.toggle("selected");
if(selectedOptions.includes(val)){
selectedOptions=selectedOptions.filter(v=>v!==val);
}else{
selectedOptions.push(val);
}
}

async function nextQuestion(){
let answer;
if(questions[currentQuestion].type==="multi"){
if(selectedOptions.length===0) return alert("Select at least one");
answer=selectedOptions;
}
else if(questions[currentQuestion].type==="slider"){
answer=document.getElementById("slider").value;
}
else{
const val=document.getElementById("answerInput").value.trim();
if(!val) return alert("Enter your answer");
answer=val;
}

await fetch("/save-answer",{method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({sessionId,questionId:questions[currentQuestion].id,answer})});

const container=document.querySelector(".card");
container.style.transform="translateX(-40px)";
container.style.opacity="0";

setTimeout(async()=>{
currentQuestion++;
if(currentQuestion<questions.length){
showQuestion();
container.style.transform="translateX(0)";
container.style.opacity="1";
}else{
await fetch("/complete-session",{method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({sessionId})});
launchConfetti();
document.getElementById("content").innerHTML=
`<div style="font-size:28px;">ðŸŽ‰ Thank you for your honesty!<br><br>Your response has been recorded.</div>`;
container.style.transform="translateX(0)";
container.style.opacity="1";
}
},300);
}
</script>

</body>
</html>