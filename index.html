<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Honest Perception</title>

<style>
* { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

body {
    margin:0;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background: linear-gradient(135deg,#667eea,#764ba2,#ff6a88,#ff99ac);
    background-size:300% 300%;
    animation: gradientMove 12s ease infinite;
}

@keyframes gradientMove {
    0% {background-position:0% 50%}
    50% {background-position:100% 50%}
    100% {background-position:0% 50%}
}

.card {
    width:90%;
    max-width:760px;
    padding:50px;
    border-radius:30px;
    backdrop-filter:blur(25px);
    background:rgba(255,255,255,0.15);
    box-shadow:0 40px 80px rgba(0,0,0,0.35);
    text-align:center;
    color:white;
    transition: all 0.4s ease;
}

h1 { font-size:30px; margin-bottom:20px; }
p { font-size:16px; opacity:0.9; margin-bottom:30px; }

button {
    padding:15px 40px;
    border-radius:30px;
    border:none;
    font-weight:bold;
    cursor:pointer;
    background:white;
    color:#333;
    transition:0.3s;
}

button:hover {
    transform:translateY(-4px);
}

input, textarea {
    width:100%;
    padding:16px;
    border-radius:15px;
    border:none;
    margin-bottom:20px;
    font-size:16px;
}

.options {
    display:flex;
    flex-wrap:wrap;
    gap:12px;
    justify-content:center;
    margin-bottom:25px;
}

.option-card {
    padding:12px 20px;
    border-radius:30px;
    cursor:pointer;
    font-size:14px;
    background:linear-gradient(135deg,#ff9a9e,#fad0c4);
    color:#333;
    font-weight:600;
    transition: all 0.3s ease;
}

.option-card.selected {
    background:linear-gradient(135deg,#00f5a0,#00d9f5);
    color:white;
}

.progress-bar-container {
    width:100%;
    height:6px;
    background:rgba(255,255,255,0.2);
    border-radius:10px;
    margin-bottom:20px;
}

.progress-bar {
    height:100%;
    background:linear-gradient(90deg,#00f5a0,#00d9f5,#ff6a88);
}

@media (max-width:600px){
    .card { padding:30px; }
    h1 { font-size:22px; }
    button { width:100%; }
}
</style>
</head>

<body>

<div class="card">
    <div id="content">
        <!-- Welcome Screen -->
        <h1>üëã Welcome</h1>
        <p>
            This is a safe space for honest feedback.<br>
            Your responses help me grow.
        </p>
        <p>
            It takes less than 1 minute.
        </p>
        <button onclick="showNameEntry()">Start</button>
    </div>
</div>

<script>

let sessionId=null;
let currentQuestion=0;
let selectedOptions=[];

const questions=[
{ id:"personality", text:"How would you describe my personality?", type:"multi",
options:["Confident","Calm","Ambitious","Caring","Funny","Reserved","Overthinking","Dominating","Insecure"] },
{ id:"standout", text:"Where do I naturally stand out?", type:"multi",
options:["Communication","Leadership","Emotional Support","Technical Skills","Decision Making","Discipline","Creativity","Networking"] },
{ id:"confidence", text:"How confident do I appear? (1‚Äì10)", type:"slider" },
{ id:"advice", text:"One brutally honest advice for me:", type:"text" }
];

function showNameEntry(){
document.getElementById("content").innerHTML=`
<h1>üìù Before We Begin</h1>
<p>Enter your name (optional honesty, not anonymous)</p>
<input type="text" id="nameInput" placeholder="Your name">
<button onclick="startQuiz()">Continue</button>
`;
}

async function startQuiz(){
const name=document.getElementById("nameInput").value.trim() || "Anonymous";

const res=await fetch("/start-session",{method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({name})});

const data=await res.json();
sessionId=data.sessionId;
showQuestion();
}

function showQuestion(){
const q=questions[currentQuestion];
selectedOptions=[];
let percent=(currentQuestion/questions.length)*100;

let html=`
<div class="progress-bar-container">
<div class="progress-bar" style="width:${percent}%"></div>
</div>
<h1>${q.text}</h1>
`;

if(q.type==="multi"){
html+=`<div class="options">`;
q.options.forEach(opt=>{
html+=`<div class="option-card" onclick="toggleOption(this,'${opt}')">${opt}</div>`;
});
html+=`</div>`;
}

if(q.type==="slider"){
html+=`
<input type="range" min="1" max="10" value="5" id="slider"
oninput="document.getElementById('sliderValue').innerText=this.value">
<div id="sliderValue" style="margin-top:10px;font-size:20px;">5</div>
`;
}

if(q.type==="text"){
html+=`<textarea id="answerInput" placeholder="Type your answer..."></textarea>`;
}

html+=`<button onclick="nextQuestion()">Next</button>`;

document.getElementById("content").innerHTML=html;
}

function toggleOption(el,val){
el.classList.toggle("selected");
if(selectedOptions.includes(val)){
selectedOptions=selectedOptions.filter(v=>v!==val);
}else{
selectedOptions.push(val);
}
}

async function nextQuestion(){
let answer;

if(questions[currentQuestion].type==="multi"){
if(selectedOptions.length===0) return alert("Select at least one");
answer=selectedOptions;
}
else if(questions[currentQuestion].type==="slider"){
answer=document.getElementById("slider").value;
}
else{
const val=document.getElementById("answerInput").value.trim();
if(!val) return alert("Enter your answer");
answer=val;
}

await fetch("/save-answer",{method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({sessionId,questionId:questions[currentQuestion].id,answer})});

currentQuestion++;

if(currentQuestion<questions.length){
showQuestion();
}else{
await fetch("/complete-session",{method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({sessionId})});

document.getElementById("content").innerHTML=
`<h1>üéâ Thank You!</h1>
<p>Your feedback means a lot.</p>`;
}
}

</script>

</body>
</html>